<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body></body>
  <!-- <script>
    class MyPromise {
      constructor(createFunc) {
        this.status = 'pending' // fulfilled rejected
        this.value = null
        this.reason = null
        this.resolveEvent = null
        this.rejectEvent = null
        this.setResolve = value => {
          if (this.status === 'pending') {
            this.status = 'fulfilled'
            this.value = value
            this.resolveEvent && this.resolveEvent(value)
          }
        }
        this.setReject = reason => {
          if (this.status === 'pending') {
            this.status = 'rejected'
            this.reason = reason
            this.rejectEvent && this.rejectEvent(reason)
          }
        }

        if (!createFunc) {
          throw new TypeError('Promise resolver undefined is not a function')
        }

        try {
          createFunc(this.setResolve, this.setReject)
        } catch (reason) {
          this.setReject(reason)
        }
      }

      then(resolveFunc, rejectFunc) {
        return new MyPromise((resolve, reject) => {
          const resolveEvent = () => {
            try {
              if (typeof resolveFunc === 'function') {
                this.excuteChildPromise(resolveFunc(this.value), resolve, reject)
              } else {
                resolve(this.value)
              }
            } catch (reason) {
              reject(reason)
            }
          }
          const rejectEvent = () => {
            try {
              if (typeof rejectFunc === 'function') {
                this.excuteChildPromise(rejectFunc(this.reason), resolve, reject)
              } else {
                reject(this.reason)
              }
            } catch (reason) {
              reject(reason)
            }
          }

          if (this.status === 'pending') {
            this.resolveEvent = resolveEvent
            this.rejectEvent = rejectEvent
          } else if (this.status === 'fulfilled') {
            resolveEvent()
          } else if (this.status === 'rejected') {
            rejectEvent()
          }
        })
      }

      excuteChildPromise(childPromise, resolve, reject) {
        if (childPromise instanceof MyPromise) {
          childPromise.then(
            childValue => {
              this.excuteChildPromise(childValue, resolve, reject)
            },
            childReason => {
              reject(childReason)
            }
          )
        } else {
          resolve(childPromise)
        }
      }

      catch(rejectFunc) {
        return this.then(null, rejectFunc)
      }

      static resolve(param) {
        if (param instanceof MyPromise) return param
        return new MyPromise(resolve => resolve(param))
      }

      static reject(param) {
        return new MyPromise((resolve, reject) => reject(param))
      }

      static all(array) {
        let resultArray = []

        return new MyPromise((resolve, reject) => {
          if (array.length === 0) {
            resolve(resultArray)
          } else {
            array.forEach(promise => {
              MyPromise.resolve(promise)
                .then(value => {
                  resultArray.push(value)
                  resultArray.length === array.length && resolve(resultArray)
                })
                .catch(reject)
            })
          }
        })
      }

      static race(array) {
        return new MyPromise((resolve, reject) => {
          array.forEach(promise => {
            MyPromise.resolve(promise).then(resolve).catch(reject)
          })
        })
      }
    }
  </script> -->
  <!-- <script>
    setTimeout(() => {
      console.log(0)
    })

    new Promise(resolve => {
      console.log(1)

      setTimeout(() => {
        resolve()
        Promise.resolve().then(() => {
          console.log(2)
          setTimeout(() => console.log(3))
          Promise.resolve().then(() => console.log(4))
        })
      })

      Promise.resolve().then(() => console.log(5))
    }).then(() => {
      console.log(6)
      Promise.resolve().then(() => console.log(7))
      setTimeout(() => console.log(8))
    })

    console.log(9)

    h: []
    w: []
    1
    9
    5
    0
    6
    2
    7
    4
    8
    3
  </script> -->
  <!-- <script>
    const async1 = async () => {
      console.log(1)
      setTimeout(() => {
        console.log(2)
      }, 2000)
      await new Promise(resolve => {
        console.log(3)
      })
      console.log(4)
      return 5
    }
    console.log(6)
    async1().then(res => console.log(res))
    console.log(7)
    Promise.resolve(8)
      .then(9)
      .then(Promise.resolve(10))
      .catch(11)
      .then(res => console.log(res))
    setTimeout(() => {
      console.log(12)
    }, 1000)

    // 输出顺序
    h: []
    w: []
  </script> -->
  <!-- <script>
    Promise.resolve()
      .then(() => {
        console.log(0)
        return Promise.resolve(4)
      })
      .then(res => {
        console.log(res)
      })
    Promise.resolve()
      .then(() => {
        console.log(1)
      })
      .then(() => {
        console.log(2)
      })
      .then(() => {
        console.log(3)
      })
      .then(() => {
        console.log(5)
      })

    h: []
    w: []
    0
    1
    2
    3
    4
    5
  </script> -->
</html>
