# 前端基础建设

### 一、i18n 多语言需求提效方案

#### 过去的多语言方案：

![image](https://img.alicdn.com/imgextra/i2/O1CN01CxQRW91HKVenYSSO3_!!6000000000739-0-tps-2410-1828.jpg)

&emsp;&emsp;通过美杜莎（阿里内部的多语言配置平台）node 程序，从代码中提取引用的 key，根据 key 在本地项目中生成一个多语言 json 文件，json 文件会和项目源码合并打包发布到线上

&emsp;&emsp;这种方式会带来 2 个问题：

&emsp;&emsp;1、运营同学想改页面上的文案，但是他并不知道这个文案对应的多语言 key 是那个，每次都要问前端同学，然后前端同学又专门翻代码去查这个 key；或者前端同学每开发一个项目时，要将该项目用到的所有 key 及对应的文案、截图做一个 excel 表格，当运营同学想改文案时，自己去查阅这个表格，前端同学在迭代项目时也要记得同时维护这个表格

![image](https://img.alicdn.com/imgextra/i4/O1CN01XXJTLI1gJ0kwX4k4J_!!6000000004120-0-tps-2722-1810.jpg)

&emsp;&emsp;2、由于多语言的 json 文件是和源码在一起的，运营同学每改一次多语言配置，前端同学还得新建一个迭代，把新的多语言 json 文件拉到本地，然后发布一次线上

#### 提效方案：

&emsp;&emsp;**关于问题 1，运营同学查询多语言 key 的解法**

&emsp;&emsp;在一次与外部团队的交流中，发现他们新开发了一个浏览器多语言插件，前端同学在源码中按照特定的方式引入多语言 key 后，将这个插件给到运营同学，安装在浏览器上并打开后，可以在页面上直接显示出对应文案的多语言配置地址，无需再去问相关前端同学或查询 excel 表格

![image](https://img.alicdn.com/imgextra/i4/O1CN01Xe1CnS28m9C39NzaU_!!6000000007974-0-tps-3308-2158.jpg)

&emsp;&emsp;**关于问题 2，每次改多语言文案都要发布一次页面的解法**

&emsp;&emsp;当用户请求某个 url 时，请求信息会走到 Node Portal 服务器，服务器会根据 url 返回对应的 index.html 文件

&emsp;&emsp;那么 Node Portal 服务器在返回 html 文件前，请求多语言服务器，获取这个页面的所有多语言 json 信息，将其变成对象，写入 html 文件（类似于服务端渲染），如此就可以实时的获取最新的多语言文案

![image](https://img.alicdn.com/imgextra/i1/O1CN01aO1L2j21kaXAQc93o_!!6000000007023-0-tps-3308-2158.jpg)

&emsp;&emsp;并且由于获取最新 json 信息的步骤由 Node Portal 服务器自动完成，而不是本地源码开发时手动获取，因此当运营同学改变文案时，前端无需在本地拉取最新 json 信息，然后重发一遍页面，运营同学改完后，线上就能够自动生效

#### 提效后的结果：

&emsp;&emsp;运营同学想改变文案时，在当前页面打开插件，点击页面上对应文案的配置链接，在多语言平台发布文案后，刷新页面即可看到最新文案，全程不需要前端同学的参与

### 二、迁移至 DaDa2.0 发布平台

#### DaDa1.0 发布平台

&emsp;&emsp;仅具备单个页面的预发、线上发布、回滚功能，js 和 css 文件被插入在 HTML 的固定位置（无法编辑 HTML 模版），无法灰度发布，无法批量发布，发布平台对业务页面有侵入性（用户打开一个页面时会先跑一段发布平台的逻辑，由该逻辑拉取真正的页面内容）

&emsp;&emsp;总之 1.0 平台，除了能发布和回滚页面这 2 个基础功能外，再无其他好处了

&emsp;&emsp;（由于该发布平台的规定，我还无法截图给大家看）

#### DaDa2.0 发布平台

&emsp;&emsp;在一次反馈 DaDa1.0 平台问题时，得知该项目组正在开发 DaDa2.0 发布平台，向我演示了半小时 2.0 平台的功能后，我发现 2.0 相比 1.0 有了质的飞跃

&emsp;&emsp;2.0 平台新增了批量发布、HTML 模版半自由配置、全局变量等功能，并且发布平台代码不再侵入业务页面，美中不足的是回滚功能被取消了

&emsp;&emsp;新增功能中我最中意的是 HTML 模版半自由配置，也就是在 HTML 上给了 4 个位置可以插入任意代码，分别是 head 标签的最上方和最下方，body 标签的最上方和最下方

&emsp;&emsp;虽说是半自由，但能控制一部分 HTML 代码，对于前端同学来说便有了很多操作空间，例如：配置 meta 标签、设置 css 全局样式、在业务代码前先加载监控平台的 js 文件、在业务代码前预请求数据等等

![image](https://img.alicdn.com/imgextra/i1/O1CN0173YTaS1cXQlKZe1r1_!!6000000003610-0-tps-3308-2158.jpg)
![image](https://img.alicdn.com/imgextra/i1/O1CN0154wlXg1YfRDxlaQAv_!!6000000003086-0-tps-3308-2158.jpg)

&emsp;&emsp;虽说 2.0 平台并不完美，但是久旱逢甘霖，对比 1.0 的巨大提升，已经足够我们花费时间从 1.0 迁移过去了，在我负责域的页面实验成功后，团队内的同学也纷纷迁移到了 2.0 平台

### 三、迁移至 Lago 发布平台

&emsp;&emsp;国际化电商场景下，国内领先的发布平台Lago出现了
